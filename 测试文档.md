# API 测试文档

## 测试环境
- **基础URL**: `http://localhost:8080`
- **测试工具**: Apifox
- **测试时间**: 2025-10-24

---

## 测试场景 1：完整的课程管理流程

### 1.1 创建课程 CS101
```http
POST /api/courses
Content-Type: application/json

{
  "code": "CS101",
  "title": "计算机科学导论",
  "instructor": {
    "id": "T001",
    "name": "张教授",
    "email": "zhang@example.edu.cn"
  },
  "schedule": {
    "dayOfWeek": "MONDAY",
    "startTime": "08:00",
    "endTime": "10:00",
    "expectedAttendance": 50
  },
  "capacity": 60
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created  
**提取变量**: `COURSE_ID = body.id`

### 1.2 创建课程 MA201
```http
POST /api/courses
Content-Type: application/json

{
  "code": "MA201",
  "title": "高等数学",
  "instructor": {
    "id": "T002",
    "name": "李教授",
    "email": "li@example.edu.cn"
  },
  "schedule": {
    "dayOfWeek": "WEDNESDAY",
    "startTime": "10:00",
    "endTime": "12:00",
    "expectedAttendance": 45
  },
  "capacity": 55
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created

### 1.3 创建课程 EN301
```http
POST /api/courses
Content-Type: application/json

{
  "code": "EN301",
  "title": "大学英语",
  "instructor": {
    "id": "T003",
    "name": "王教授",
    "email": "wang@example.edu.cn"
  },
  "schedule": {
    "dayOfWeek": "FRIDAY",
    "startTime": "14:00",
    "endTime": "16:00",
    "expectedAttendance": 40
  },
  "capacity": 50
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created

### 1.4 查询所有课程
```http
GET /api/courses
```

**预期响应**: 200 OK，包含3条课程记录  
**实际响应**: 200 OK  
**验证断言**: `body.length === 3`

### 1.5 根据ID查询课程
```http
GET /api/courses/{{COURSE_ID}}
```

**预期响应**: 200 OK，返回指定课程信息  
**实际响应**: 200 OK

### 1.6 更新课程信息
```http
PUT /api/courses/{{COURSE_ID}}
Content-Type: application/json

{
  "id": "{{COURSE_ID}}",
  "code": "CS101",
  "title": "计算机科学导论（全英）",
  "instructor": {
    "id": "T001",
    "name": "张教授",
    "email": "zhang@example.edu.cn"
  },
  "schedule": {
    "dayOfWeek": "MONDAY",
    "startTime": "08:00",
    "endTime": "10:00",
    "expectedAttendance": 50
  },
  "capacity": 80
}
```

**预期响应**: 200 OK  
**实际响应**: 200 OK

### 1.7 删除课程
```http
DELETE /api/courses/{{COURSE_ID}}
```

**预期响应**: 200 No Content  
**实际响应**: 200 No Content

### 1.8 验证课程已删除
```http
GET /api/courses/{{COURSE_ID}}
```

**预期响应**: 404 Not Found  
**实际响应**: 404 Not Found

---

## 测试场景 2：选课业务流程

### 2.1 创建容量为2的课程
```http
POST /api/courses
Content-Type: application/json

{
  "code": "CAP2",
  "title": "容量2课程",
  "instructor": {
    "id": "T004",
    "name": "赵教授",
    "email": "zhao@example.edu.cn"
  },
  "schedule": {
    "dayOfWeek": "TUESDAY",
    "startTime": "08:00",
    "endTime": "09:40",
    "expectedAttendance": 2
  },
  "capacity": 2
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created  
**提取变量**: `CAP2_ID = body.id`

### 2.2 学生 S001 选课
```http
POST /api/enrollments
Content-Type: application/json

{
  "studentId": "S001",
  "courseId": "{{CAP2_ID}}"
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created

### 2.3 学生 S002 选课
```http
POST /api/enrollments
Content-Type: application/json

{
  "studentId": "S002",
  "courseId": "{{CAP2_ID}}"
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created

### 2.4 学生 S003 选课（容量已满）
```http
POST /api/enrollments
Content-Type: application/json

{
  "studentId": "S003",
  "courseId": "{{CAP2_ID}}"
}
```

**预期响应**: 409 Conflict  
**实际响应**: 409 Conflict

### 2.5 学生 S001 再次选课（重复选课）
```http
POST /api/enrollments
Content-Type: application/json

{
  "studentId": "S001",
  "courseId": "{{CAP2_ID}}"
}
```

**预期响应**: 409 Conflict  
**实际响应**: 409 Conflict

### 2.6 验证课程 enrolled 字段
```http
GET /api/courses/{{CAP2_ID}}
```

**预期响应**: 200 OK，`body.enrolled === 2`  
**实际响应**: 200 OK  
**验证断言**: `body.enrolled === 2`

---

## 测试场景 3：学生管理流程

### 3.1 创建学生 S2024001
```http
POST /api/students
Content-Type: application/json

{
  "studentId": "S2024001",
  "name": "Alice",
  "major": "CS",
  "grade": 1,
  "email": "alice@stu.zjsu.edu.cn"
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created  
**提取变量**: `S2024001_ID = body.id`

### 3.2 创建学生 S2024002
```http
POST /api/students
Content-Type: application/json

{
  "studentId": "S2024002",
  "name": "Bob",
  "major": "SE",
  "grade": 1,
  "email": "bob@stu.zjsu.edu.cn"
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created  
**提取变量**: `S2024002_ID = body.id`

### 3.3 创建学生 S2024003
```http
POST /api/students
Content-Type: application/json

{
  "studentId": "S2024003",
  "name": "Carol",
  "major": "MA",
  "grade": 1,
  "email": "carol@stu.zjsu.edu.cn"
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created  
**提取变量**: `S2024003_ID = body.id`

### 3.4 查询所有学生
```http
GET /api/students
```

**预期响应**: 200 OK，包含3条学生记录  
**实际响应**: 200 OK  
**验证断言**: `body.length === 3`

### 3.5 根据ID查询学生
```http
GET /api/students/{{S2024001_ID}}
```

**预期响应**: 200 OK，返回指定学生信息  
**实际响应**: 200 OK

### 3.6 更新学生信息
```http
PUT /api/students/{{S2024001_ID}}
Content-Type: application/json

{
  "id": "{{S2024001_ID}}",
  "studentId": "S2024001",
  "name": "Alice",
  "major": "AI",
  "grade": 1,
  "email": "alice.ai@stu.zjsu.edu.cn"
}
```

**预期响应**: 200 OK  
**实际响应**: 200 OK

### 3.7 不存在的学生选课
```http
POST /api/enrollments
Content-Type: application/json

{
  "studentId": "S9999",
  "courseId": "{{CAP2_ID}}"
}
```

**预期响应**: 404 Not Found  
**实际响应**: 404 Not Found

### 3.8 学生 S2024001 选课
```http
POST /api/enrollments
Content-Type: application/json

{
  "studentId": "S2024001",
  "courseId": "{{CAP2_ID}}"
}
```

**预期响应**: 201 Created  
**实际响应**: 201 Created

### 3.9 尝试删除有选课记录的学生
```http
DELETE /api/students/{{S2024001_ID}}
```

**预期响应**: 409 Conflict  
**实际响应**: 409 Conflict

### 3.10 删除没有选课记录的学生
```http
DELETE /api/students/{{S2024003_ID}}
```

**预期响应**: 200 No Content  
**实际响应**: 200 No Content

---

## 测试场景 4：错误处理

### 4.1 查询不存在的课程
```http
GET /api/courses/99999999
```

**预期响应**: 404 Not Found  
**实际响应**: 404 Not Found

### 4.2 创建课程缺少必填字段
```http
POST /api/courses
Content-Type: application/json

{
  "code": "CS103"
}
```

**预期响应**: 400 Bad Request  
**实际响应**: 400 Bad Request

### 4.3 选课时提供不存在的课程ID
```http
POST /api/enrollments
Content-Type: application/json

{
  "studentId": "S001",
  "courseId": "99999999-0000-0000-0000-000000000000"
}
```

**预期响应**: 404 Not Found  
**实际响应**: 404 Not Found

### 4.4 创建学生时使用重复的studentId
```http
POST /api/students
Content-Type: application/json

{
  "studentId": "S2024002",
  "name": "Dup",
  "major": "XX",
  "grade": 1,
  "email": "dup@stu.zjsu.edu.cn"
}
```

**预期响应**: 409 Conflict  
**实际响应**: 409 Conflict

### 4.5 创建学生时使用无效邮箱格式
```http
POST /api/students
Content-Type: application/json

{
  "studentId": "S2024004",
  "name": "Dave",
  "major": "EE",
  "grade": 1,
  "email": "invalid-email"
}
```

**预期响应**: 400 Bad Request  
**实际响应**: 400 Bad Request

---

## 测试结果总结

### 通过情况
- ✅ 所有测试场景均按预期执行
- ✅ API响应格式统一规范
- ✅ 错误处理机制完善
- ✅ 业务逻辑验证正确

### 遇到的问题和解决方案
1. **路径参数问题**：在Apifox中使用`{id}`格式时出现404错误
   - **解决方案**：直接在URL中使用具体ID值，避免路径参数解析问题

2. **变量提取问题**：在Apifox中正确设置环境变量确保测试流程连贯
   - **解决方案**：使用`extract`功能从响应体中提取关键ID值

3. **状态码验证**：确保所有HTTP状态码符合预期
   - **解决方案**：严格验证每个请求的`expectStatus`
